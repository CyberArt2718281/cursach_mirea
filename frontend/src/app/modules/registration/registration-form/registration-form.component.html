<div class="container">
  <div class="card">
    <div class="card-header">
      <h1 class="card-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ</h1>
    </div>

    <div *ngIf="event" class="event-info">
      <h2>{{ event.title }}</h2>
      <p><strong>üìÖ –î–∞—Ç–∞:</strong> {{ formatDate(event.date) }}</p>
      <p><strong>üìç –ú–µ—Å—Ç–æ:</strong> {{ event.location }}</p>
      <p>
        <strong>üí∫ –î–æ—Å—Ç—É–ø–Ω–æ –º–µ—Å—Ç:</strong> {{ event.availableSeats }} –∏–∑
        {{ event.capacity }}
      </p>
      <p *ngIf="event.price > 0">
        <strong>üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> {{ event.price }} ‚ÇΩ
      </p>
      <p *ngIf="event.price === 0"><strong>üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> –ë–µ—Å–ø–ª–∞—Ç–Ω–æ</p>
    </div>

    <div *ngIf="success" class="success-container">
      <div class="success-header">
        <div class="success-icon">‚úÖ</div>
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h2>
      </div>

      <div class="qr-code-section">
        <h3>üé´ –í–∞—à QR-–∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞</h3>
        <div class="qr-code-wrapper">
          <qrcode
            [qrdata]="qrCodeData"
            [width]="256"
            [errorCorrectionLevel]="'M'"
            [colorDark]="'#8b5cf6'"
            [colorLight]="'#ffffff'"
          >
          </qrcode>
        </div>
        <p class="qr-hint">
          üì± –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ –ø—Ä–µ–¥—ä—è–≤–∏—Ç–µ QR-–∫–æ–¥ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        </p>
      </div>

      <div class="registration-details">
        <div class="detail-item">
          <span class="detail-label">–ù–æ–º–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</span>
          <span class="detail-value">{{ registrationNumber }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Email:</span>
          <span class="detail-value">{{ participantEmail }}</span>
        </div>
      </div>

      <div class="email-notification">
        <div class="notification-icon">üìß</div>
        <div class="notification-text">
          <strong>–ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</strong>
          <p>
            –ù–∞ –∞–¥—Ä–µ—Å <strong>{{ participantEmail }}</strong> –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∏—Å—å–º–æ —Å
            QR-–∫–æ–¥–æ–º –∏ –¥–µ—Ç–∞–ª—è–º–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–ø–∫—É "–í—Ö–æ–¥—è—â–∏–µ" –∏–ª–∏
            "–°–ø–∞–º".
          </p>
        </div>
      </div>

      <button (click)="router.navigate(['/events'])" class="btn btn-primary">
        –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É —Å–æ–±—ã—Ç–∏–π
      </button>
    </div>

    <div *ngIf="error && !success" class="alert alert-danger">{{ error }}</div>

    <form
      *ngIf="!success && event && event.availableSeats > 0"
      [formGroup]="registrationForm"
      (ngSubmit)="onSubmit()"
    >
      <h2 style="margin-bottom: 20px">–î–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="firstName">–ò–º—è *</label>
          <input
            type="text"
            id="firstName"
            formControlName="firstName"
            class="form-control"
            [class.error-border]="
              registrationForm.get('firstName')?.invalid &&
              registrationForm.get('firstName')?.touched
            "
          />
          <div
            class="error"
            *ngIf="
              registrationForm.get('firstName')?.invalid &&
              registrationForm.get('firstName')?.touched
            "
          >
            –ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (–º–∞–∫—Å. 50 —Å–∏–º–≤–æ–ª–æ–≤)
          </div>
        </div>

        <div class="form-group">
          <label for="lastName">–§–∞–º–∏–ª–∏—è *</label>
          <input
            type="text"
            id="lastName"
            formControlName="lastName"
            class="form-control"
            [class.error-border]="
              registrationForm.get('lastName')?.invalid &&
              registrationForm.get('lastName')?.touched
            "
          />
          <div
            class="error"
            *ngIf="
              registrationForm.get('lastName')?.invalid &&
              registrationForm.get('lastName')?.touched
            "
          >
            –§–∞–º–∏–ª–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ (–º–∞–∫—Å. 50 —Å–∏–º–≤–æ–ª–æ–≤)
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email">Email *</label>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-control"
            [class.error-border]="
              registrationForm.get('email')?.invalid &&
              registrationForm.get('email')?.touched
            "
          />
          <div
            class="error"
            *ngIf="
              registrationForm.get('email')?.invalid &&
              registrationForm.get('email')?.touched
            "
          >
            –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email
          </div>
        </div>

        <div class="form-group">
          <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
          <input
            type="tel"
            id="phone"
            formControlName="phone"
            class="form-control"
            placeholder="+7 (999) 123-45-67"
            [class.error-border]="
              registrationForm.get('phone')?.invalid &&
              registrationForm.get('phone')?.touched
            "
          />
          <div
            class="error"
            *ngIf="
              registrationForm.get('phone')?.invalid &&
              registrationForm.get('phone')?.touched
            "
          >
            –¢–µ–ª–µ—Ñ–æ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="organization">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label>
          <input
            type="text"
            id="organization"
            formControlName="organization"
            class="form-control"
            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∏–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏"
          />
        </div>

        <div class="form-group">
          <label for="position">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
          <input
            type="text"
            id="position"
            formControlName="position"
            class="form-control"
            placeholder="–í–∞—à–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="notes">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
        <textarea
          id="notes"
          formControlName="notes"
          class="form-control"
          rows="3"
          placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–ª–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è"
        >
        </textarea>
      </div>

      <div class="form-actions">
        <button
          type="submit"
          class="btn btn-success"
          [disabled]="loading || registrationForm.invalid"
        >
          {{ loading ? "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è..." : "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è" }}
        </button>
        <button
          type="button"
          (click)="router.navigate(['/events', event._id])"
          class="btn btn-secondary"
        >
          –û—Ç–º–µ–Ω–∞
        </button>
      </div>
    </form>

    <div
      *ngIf="event && event.availableSeats === 0 && !success"
      class="text-center"
      style="padding: 40px"
    >
      <h3>üòî –í—Å–µ –º–µ—Å—Ç–∞ –∑–∞–Ω—è—Ç—ã</h3>
      <p>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –∑–∞–∫—Ä—ã—Ç–∞</p>
      <button
        (click)="router.navigate(['/events'])"
        class="btn btn-primary"
        style="margin-top: 15px"
      >
        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ —Å–æ–±—ã—Ç–∏—è
      </button>
    </div>
  </div>
</div>
