<div class="container">
  <div class="card">
    <div class="card-header">
      <h1 class="card-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è–º–∏</h1>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class="filters-section">
      <select
        [(ngModel)]="selectedStatus"
        (change)="onFilterChange()"
        class="form-control"
      >
        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</option>
        <option value="–æ–∂–∏–¥–∞–Ω–∏–µ">–û–∂–∏–¥–∞–Ω–∏–µ</option>
        <option value="–æ—Ç–º–µ–Ω–µ–Ω–∞">–û—Ç–º–µ–Ω–µ–Ω–∞</option>
      </select>

      <input
        type="text"
        [(ngModel)]="searchQuery"
        (keyup.enter)="onSearch()"
        placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, email –∏–ª–∏ –Ω–æ–º–µ—Ä—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏..."
        class="form-control"
      />

      <button (click)="onSearch()" class="btn btn-primary">üîç –ü–æ–∏—Å–∫</button>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div *ngIf="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π...</div>
    <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π -->
    <div
      *ngIf="!loading && registrations.length > 0"
      class="registrations-grid"
    >
      <div *ngFor="let registration of registrations" class="registration-card">
        <div class="registration-header">
          <div class="registration-number">
            ‚Ññ {{ registration.registrationNumber }}
          </div>
          <span class="status-badge" [class]="'status-' + registration.status">
            {{ registration.status }}
          </span>
        </div>

        <div class="registration-body">
          <div class="info-item">
            <span class="info-label">üë§ –£—á–∞—Å—Ç–Ω–∏–∫</span>
            <span class="info-value">
              {{ registration.participant.firstName }}
              {{ registration.participant.lastName }}
            </span>
          </div>

          <div class="info-item">
            <span class="info-label">üìß Email</span>
            <span class="info-value">{{ registration.participant.email }}</span>
          </div>

          <div class="info-item">
            <span class="info-label">üì± –¢–µ–ª–µ—Ñ–æ–Ω</span>
            <span class="info-value">{{ registration.participant.phone }}</span>
          </div>

          <div class="info-item">
            <span class="info-label">üéØ –°–æ–±—ã—Ç–∏–µ</span>
            <span class="info-value" *ngIf="registration.event; else noEvent">
              {{ getEventTitle(registration.event) }}
            </span>
            <ng-template #noEvent>
              <span class="info-value event-deleted">–°–æ–±—ã—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ</span>
            </ng-template>
          </div>

          <div class="info-item">
            <span class="info-label">‚úì –ü–æ—Å–µ—â–µ–Ω–∏–µ</span>
            <span
              class="info-value attended-badge"
              [class.attended-yes]="registration.attended"
              [class.attended-no]="!registration.attended"
            >
              {{ registration.attended ? "–ü–æ—Å–µ—Ç–∏–ª" : "–ù–µ –æ—Ç–º–µ—á–µ–Ω" }}
            </span>
          </div>

          <div class="info-item">
            <span class="info-label">üìÖ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</span>
            <span class="info-value">{{
              formatDate(registration.createdAt)
            }}</span>
          </div>
        </div>

        <div class="registration-footer">
          <button
            *ngIf="
              !registration.attended &&
              registration.status === '–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞' &&
              registration._id
            "
            (click)="markAsAttended(registration._id)"
            class="btn btn-sm btn-success"
            title="–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø–æ—Å–µ—Ç–∏–≤—à–µ–≥–æ"
          >
            ‚úì –û—Ç–º–µ—Ç–∏—Ç—å –ø–æ—Å–µ—â–µ–Ω–∏–µ
          </button>
          <button
            *ngIf="registration.status !== '–æ—Ç–º–µ–Ω–µ–Ω–∞' && registration._id"
            (click)="cancelRegistration(registration._id)"
            class="btn btn-sm btn-danger"
            title="–û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é"
          >
            ‚úó –û—Ç–º–µ–Ω–∏—Ç—å
          </button>
        </div>
      </div>
    </div>

    <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ -->
    <div
      *ngIf="!loading && registrations.length === 0"
      class="text-center"
      style="padding: 40px"
    >
      <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
      <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button
        (click)="previousPage()"
        [disabled]="currentPage === 1"
        class="btn btn-secondary"
      >
        ‚Üê –ù–∞–∑–∞–¥
      </button>
      <span style="margin: 0 20px">
        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ currentPage }} –∏–∑ {{ totalPages }} (–í—Å–µ–≥–æ:
        {{ totalRegistrations }})
      </span>
      <button
        (click)="nextPage()"
        [disabled]="currentPage === totalPages"
        class="btn btn-secondary"
      >
        –í–ø–µ—Ä–µ–¥ ‚Üí
      </button>
    </div>
  </div>
</div>
